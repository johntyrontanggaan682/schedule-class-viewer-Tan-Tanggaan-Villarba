<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>SLSU Lucena Class Schedule Viewer — Profile</title>
<script src="https://cdn.tailwindcss.com/3.4.16"></script>
<script>
tailwind.config = {
  theme: {
    extend: {
      colors: { primary:'#16a34a', secondary:'#22c55e', leaf:'#34d399' },
      borderRadius: { DEFAULT:'14px','lg':'18px','xl':'22px','2xl':'26px','full':'9999px' },
      boxShadow: { glow:'0 18px 60px rgba(22,163,74,.18)', soft:'0 10px 30px rgba(0,0,0,.08), inset 0 1px 0 rgba(255,255,255,.35)' },
      backgroundImage: { mesh: 'radial-gradient(40% 60% at 10% 10%, rgba(34,197,94,.18) 0, transparent 60%), radial-gradient(35% 45% at 90% 20%, rgba(16,185,129,.18) 0, transparent 60%), radial-gradient(30% 40% at 50% 100%, rgba(59,130,246,.14) 0, transparent 60%)' }
    }
  }
}
</script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.6.0/remixicon.min.css" rel="stylesheet">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Plus+Jakarta+Sans:wght@500;700&display=swap" rel="stylesheet">
<style>
:where([class^="ri-"])::before{content:"\f3c2"}
body{font-family:Inter, system-ui, Segoe UI, Roboto, Arial}
.title-font{font-family:"Plus Jakarta Sans", Inter, system-ui}
</style>
</head>
<body class="bg-gray-50 min-h-screen">

<nav class="bg-primary text-white shadow-lg fixed w-full top-0 z-50">
  <div class="px-6 py-4">
    <div class="flex items-center justify-between">
      <div class="flex items-center space-x-3">
        <img src="lucenalogo.jpg" class="w-16 h-16 object-contain rounded-full" alt="">
        <h1 class="text-xl font-bold">SLSU Lucena Class Schedule Viewer</h1>
      </div>
      <div class="hidden md:flex items-center space-x-2">
        <a href="index.html"    class="px-3 py-2 rounded-lg hover:bg-white/10 flex items-center gap-2"><i class="ri-home-line"></i><span>Home</span></a>
        <a href="sections.html" class="px-3 py-2 rounded-lg hover:bg-white/10 flex items-center gap-2"><i class="ri-book-2-line"></i><span>Sections</span></a>
        <a href="schedules.html"class="px-3 py-2 rounded-lg hover:bg-white/10 flex items-center gap-2"><i class="ri-calendar-line"></i><span>Schedules</span></a>
        <a href="students.html" class="px-3 py-2 rounded-lg hover:bg-white/10 flex items-center gap-2"><i class="ri-user-line"></i><span>Students</span></a>
        <a href="teachers.html" class="px-3 py-2 rounded-lg hover:bg-white/10 flex items-center gap-2"><i class="ri-user-star-line"></i><span>Teachers</span></a>
        <a href="profile.html"  class="px-3 py-2 rounded-lg bg-white/20 flex items-center gap-2"><i class="ri-user-3-line"></i><span>Profile</span></a>
      </div>
      <button id="mobile-menu-btn" class="md:hidden p-2 rounded-lg hover:bg-white/10"><i class="ri-menu-line text-xl"></i></button>
    </div>
  </div>
</nav>

<header class="relative pt-36">
  <div class="absolute inset-0 bg-mesh opacity-90"></div>
  <div class="absolute inset-0 bg-gradient-to-b from-white/60 via-white/60 to-white/90"></div>

  <div class="relative z-10 px-6 pb-16">
    <div class="max-w-5xl mx-auto mt-4">
      <div class="rounded-2xl md:rounded-3xl border border-white/40 bg-white/70 backdrop-blur-md shadow-glow">
        <div class="p-6 md:p-8">
          <div class="flex flex-col md:flex-row md:items-center gap-8 md:gap-10">
            <div class="w-full md:w-auto">
              <div id="avatar" class="w-36 h-36 md:w-40 md:h-40 mx-auto md:mx-0 rounded-2xl bg-white/90 backdrop-blur border-2 border-primary/30 shadow-soft flex items-center justify-center text-4xl font-extrabold text-primary overflow-hidden"></div>
              <div class="mt-3 flex items-center justify-center md:justify-start">
                <input id="file-input" type="file" accept="image/*" class="hidden" />
                <button id="btn-change" class="px-3 py-1.5 text-sm rounded-full border border-primary text-primary bg-white hover:bg-primary/10 active:scale-95">
                  Change Photo
                </button>
              </div>
              <div id="upload-status" class="text-xs text-gray-500 mt-2 text-center md:text-left"></div>
            </div>

            <div class="flex-1">
              <h1 id="name-heading" class="title-font text-3xl md:text-5xl font-extrabold tracking-tight text-gray-900"></h1>
              <div class="mt-4 flex flex-wrap items-center gap-2">
                <span id="role-badge" class="px-3 py-1 rounded-full text-xs font-semibold bg-primary/10 text-primary border border-primary/20 inline-flex items-center gap-1">
                  <i class="ri-shield-user-line"></i><span>Student</span>
                </span>
                <span id="status-chip" class="hidden px-3 py-1 rounded-full text-xs font-semibold bg-emerald-50 text-emerald-700 border border-emerald-200"></span>
                <span class="inline-flex items-center gap-1 text-sm text-gray-600">
                  <i class="ri-mail-line"></i><span id="email-sub"></span>
                </span>
              </div>
              <div class="mt-2 flex items-center gap-1 text-sm text-gray-600">
                <i class="ri-id-card-line"></i><span id="id-sub"></span>
              </div>

              <div class="mt-6 flex flex-wrap items-center gap-3">
                <a href="index.html" class="px-4 py-2 rounded-full border border-primary/30 text-primary bg-white hover:bg-primary/5 active:scale-95 text-sm flex items-center gap-2">
                  <i class="ri-arrow-left-line"></i><span>Back to Home</span>
                </a>
                <button id="signout" class="px-4 py-2 rounded-full bg-primary text-white hover:bg-primary/90 active:scale-95 text-sm shadow-sm flex items-center gap-2">
                  <i class="ri-logout-box-r-line"></i><span>Sign out</span>
                </button>
              </div>
            </div>
          </div>
        </div>

        <div class="h-px bg-gradient-to-r from-transparent via-primary/30 to-transparent"></div>

        <div class="p-6 md:p-8">
          <div class="grid md:grid-cols-2 gap-6">
            <div class="rounded-2xl border border-gray-200 bg-white shadow-sm p-5">
              <div class="text-xs uppercase tracking-wide text-gray-500">Full Name</div>
              <div id="d-name" class="mt-1.5 text-gray-900 font-semibold"></div>
            </div>
            <div class="rounded-2xl border border-gray-200 bg-white shadow-sm p-5">
              <div class="text-xs uppercase tracking-wide text-gray-500">Role</div>
              <div id="d-role" class="mt-1.5 text-gray-900 font-semibold"></div>
            </div>
            <div class="rounded-2xl border border-gray-200 bg-white shadow-sm p-5">
              <div class="text-xs uppercase tracking-wide text-gray-500">Email</div>
              <div id="d-email" class="mt-1.5 text-gray-900 font-semibold break-all"></div>
            </div>
            <div class="rounded-2xl border border-gray-200 bg-white shadow-sm p-5">
              <div class="text-xs uppercase tracking-wide text-gray-500">Section</div>
              <div id="d-id" class="mt-1.5 text-gray-900 font-semibold"></div>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>
</header>

<main class="pb-24"></main>

<!-- OLD-STYLE, PERFECTLY CENTERED SIGN OUT MODAL -->
<div id="confirm-modal" class="fixed inset-0 bg-black/40 hidden flex items-center justify-center z-[60]">
  <div class="bg-white rounded-2xl p-6 w-full max-w-sm shadow-xl text-center">
    <div class="text-lg font-semibold text-gray-900">Sign out?</div>
    <p class="mt-2 text-sm text-gray-600">Are you sure you want to sign out?</p>
    <div class="mt-6 flex items-center justify-center gap-3">
      <button id="cancel-signout" class="px-4 py-2 rounded-full bg-gray-100 text-gray-800 hover:bg-gray-200">Cancel</button>
      <button id="confirm-signout" class="px-4 py-2 rounded-full bg-primary text-white hover:bg-primary/90">Yes</button>
    </div>
  </div>
</div>

<footer class="bg-primary text-white py-10">
  <div class="px-6">
    <div class="max-w-6xl mx-auto text-center text-white/80 text-sm">© 2025 SLSU Lucena. All rights reserved.</div>
  </div>
</footer>

<script type="module" src="assets/js/firebase-config.js"></script>
<script type="module">
  import { onAuthStateChanged, signOut, updateProfile } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-auth.js";
  import { doc, getDoc, setDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore.js";

  const { auth, db } = window.__FB;
  const initials = s => (s||'').trim().split(/\s+/).slice(0,2).map(x=>x[0]?.toUpperCase()||'').join('') || 'GU';
  const cap = s => s ? s.charAt(0).toUpperCase()+s.slice(1) : '';

  let currentUser = null, cachedData = {};

  onAuthStateChanged(auth, async (user)=>{
    if(!user){ location.href='about.html'; return; }
    currentUser = user;

    const snap = await getDoc(doc(db,'users',user.uid));
    cachedData = snap.exists()? snap.data(): { name:user.displayName||'User', email:user.email||'', role:'guest' };

    const avatarEl = document.getElementById('avatar');
    avatarEl.innerHTML = '';
    const url = cachedData.photoURL || user.photoURL || '';
    if (url) {
      avatarEl.innerHTML = `<img src="${url}?v=${Date.now()}" class="w-full h-full object-cover" alt="Profile">`;
      sessionStorage.setItem('auth_photo', url);
    } else {
      avatarEl.textContent = initials(cachedData.name);
      sessionStorage.removeItem('auth_photo');
    }

    document.getElementById('name-heading').textContent = cachedData.name || 'User';
    document.getElementById('email-sub').textContent = cachedData.email || '—';
    document.getElementById('id-sub').textContent = 'ID: ' + (cachedData.studentId || sessionStorage.getItem('auth_id') || '—');

    const status = (cachedData.status || sessionStorage.getItem('auth_status') || '').trim();
    const statusChip = document.getElementById('status-chip');
    if (status) { statusChip.textContent = cap(status); statusChip.classList.remove('hidden'); }
    else { statusChip.textContent = ''; statusChip.classList.add('hidden'); }

    document.getElementById('d-name').textContent  = cachedData.name || '—';
    document.getElementById('d-role').textContent  = cap(cachedData.role||'guest');
    document.getElementById('d-email').textContent = cachedData.email || '—';
    document.getElementById('d-id').textContent    = cachedData.section || '—';

    sessionStorage.setItem('auth_name', cachedData.name||'User');
    sessionStorage.setItem('auth_role', cachedData.role||'guest');
    sessionStorage.setItem('auth_email', cachedData.email||'');
    if (cachedData.studentId) sessionStorage.setItem('auth_id', cachedData.studentId);
    if (cachedData.section)   sessionStorage.setItem('auth_section', cachedData.section);
    if (cachedData.status)    sessionStorage.setItem('auth_status', cachedData.status);
  });

  const fileInput = document.getElementById('file-input');
  document.getElementById('btn-change').addEventListener('click', ()=> fileInput.click());
  fileInput.addEventListener('change', async (e)=>{
    const f = e.target.files?.[0]; if(!f || !currentUser) return;
    const status = document.getElementById('upload-status'); status.textContent = 'Uploading...';
    try{
      const form = new FormData();
      form.append('file', f);
      form.append('upload_preset', "slsu-class");
      form.append('folder', 'avatars');

      const r = await fetch(`https://api.cloudinary.com/v1_1/dexqmjbtj/image/upload`, { method:'POST', body: form });
      const j = await r.json();
      if(!j.secure_url) throw new Error(j.error?.message || 'Upload failed');

      const url = j.secure_url;
      await setDoc(doc(db,'users',currentUser.uid), { photoURL:url, updatedAt:serverTimestamp() }, { merge:true });
      await updateProfile(currentUser, { photoURL:url });

      sessionStorage.setItem('auth_photo', url);
      document.getElementById('avatar').innerHTML = `<img src="${url}?v=${Date.now()}" class="w-full h-full object-cover">`;
      status.textContent = 'Saved!';
    }catch(e){
      alert('Upload failed: ' + (e.message||e));
      status.textContent = 'Upload failed';
    }finally{
      setTimeout(()=> status.textContent='', 1500);
    }
  });

  const modal = document.getElementById('confirm-modal');
  document.getElementById('signout').addEventListener('click', ()=> modal.classList.remove('hidden'));
  document.getElementById('cancel-signout').addEventListener('click', ()=> modal.classList.add('hidden'));
  document.getElementById('confirm-signout').addEventListener('click', async ()=>{
    try{ await signOut(auth);}catch(_){}
    sessionStorage.clear();
    location.href='about.html';
  });
</script>
</body>
</html>
