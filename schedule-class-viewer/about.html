<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SLSU Lucena — Login</title>

  <script src="https://cdn.tailwindcss.com/3.4.16"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: { primary:'#16a34a', secondary:'#22c55e' },
          borderRadius: { 'none':'0px','sm':'4px',DEFAULT:'8px','md':'12px','lg':'16px','xl':'20px','2xl':'24px','3xl':'32px','full':'9999px','button':'8px' },
          boxShadow: { glow: '0 10px 30px rgba(22,163,74,.15)' },
          keyframes:{
            fadeIn:{ from:{opacity:0,transform:'translateY(6px)'}, to:{opacity:1,transform:'none'} },
            fadeOut:{ from:{opacity:1}, to:{opacity:0} },
            pulseCard:{ '0%,100%':{ boxShadow:'0 10px 30px rgba(22,163,74,.15)' }, '50%':{ boxShadow:'0 16px 50px rgba(22,163,74,.35)'} }
          },
          animation:{
            'fade-in':'fadeIn .25s ease-out both',
            'fade-out':'fadeOut .25s ease-in both',
            'pulse-card':'pulseCard 1.6s ease-in-out 1'
          }
        }
      }
    }
  </script>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.6.0/remixicon.min.css" rel="stylesheet">
  <style>
    :where([class^="ri-"])::before{content:"\f3c2";}
    body { font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial; }
    @media (min-width: 768px){ .bg-shift-top{ background-position: center -140px !important; } }
    @media (max-width: 767px){ .bg-shift-top{ background-position: center -80px !important; } }
  </style>
</head>
<body class="bg-gray-50 min-h-screen">

 
  <div id="toast" class="fixed left-1/2 -translate-x-1/2 top-5 z-[60] hidden">
    <div class="rounded-xl bg-white shadow-2xl border border-green-200 px-4 py-3 text-sm text-green-800 flex items-center gap-2">
      <i class="ri-check-double-line text-lg"></i>
      <span id="toast-msg"></span>
    </div>
  </div>

  <main class="pt-0">
    <section class="min-h-[calc(100vh-5rem)] bg-white relative overflow-hidden">
      <div class="absolute inset-0">
        <div class="absolute inset-0 bg-center bg-cover opacity-30 bg-shift-top" style="background-image:url('lucena.png')"></div>
        <div class="absolute inset-0 bg-gradient-to-br from-white/30 via-white/20 to-white/10"></div>
        <div class="absolute -left-24 top-24 w-72 h-72 rounded-full bg-primary/10 blur-3xl"></div>
        <div class="absolute -right-24 bottom-10 w-72 h-72 rounded-full bg-secondary/10 blur-3xl"></div>
      </div>

      <div class="relative px-6 py-12">
        <div class="max-w-[560px] mx-auto mb-4 px-4 flex items-center gap-3">
          <img src="lucenalogo.jpg" alt="SLSU Lucena Logo" class="w-9 h-9 rounded-full object-cover ring-2 ring-primary/20">
          <div class="leading-tight">
            <div class="text-sm font-semibold text-gray-800">SLSU Lucena</div>
            <div class="text-[11px] text-gray-500 -mt-0.5">Class Schedule Management System</div>
          </div>
          <div class="ml-auto flex items-center gap-2 text-gray-500 text-xs">
            <i class="ri-time-line"></i><span>Academic Year 2025–2026</span>
          </div>
        </div>

        <div id="login-card" class="max-w-[560px] mx-auto bg-white rounded-2xl border border-gray-200 shadow-glow overflow-hidden animate-fade-in">
          <div class="bg-primary text-white px-6 py-5">
            <div class="flex items-center gap-3">
              <div class="w-9 h-9 rounded-full bg-white/20 flex items-center justify-center">
                <i class="ri-key-2-line text-xl"></i>
              </div>
              <div>
                <h2 class="text-lg font-bold leading-none">Sign In</h2>
                <p class="text-[12px] opacity-90">Access your class schedule and manage your academic information</p>
              </div>
            </div>
          </div>

          <!-- Role tabs -->
          <div class="px-5 md:px-6 pt-5 md:pt-6">
            <div class="inline-flex bg-gray-100 p-1 rounded-full text-sm">
              <button id="tab-student" class="tab-btn px-4 py-2 rounded-full font-medium bg-white text-primary shadow-sm flex items-center gap-2 transition">
                <i class="ri-graduation-cap-line"></i><span>Student</span>
              </button>
              <button id="tab-teacher" class="tab-btn px-4 py-2 rounded-full text-gray-700 hover:text-primary flex items-center gap-2 transition">
                <i class="ri-user-voice-line"></i><span>Teacher</span>
              </button>
              <button id="tab-admin" class="tab-btn px-4 py-2 rounded-full text-gray-700 hover:text-primary flex items-center gap-2 transition">
                <i class="ri-shield-user-line"></i><span>Admin</span>
              </button>
            </div>
          </div>

          <!-- FORM -->
          <div class="px-5 md:px-6 py-5 md:py-6 max-h-[60vh] overflow-y-auto">
            <form id="login-form" class="space-y-4">
              <div id="student-name-row" class="hidden">
                <label class="block text-sm font-medium text-gray-700 mb-2">Full Name</label>
                <div class="relative">
                  <i class="ri-user-3-line absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                  <input id="student-fullname" type="text" class="w-full pl-10 pr-3 py-3 border border-gray-300 rounded-button focus:ring-2 focus:ring-primary focus:border-primary text-sm" placeholder="Enter your full name">
                </div>
              </div>

              <div>
                <label id="id-label" class="block text-sm font-medium text-gray-700 mb-2">Student ID</label>
                <div class="relative">
                  <i class="ri-id-card-line absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                  <input id="id-input" type="text" required class="w-full pl-10 pr-3 py-3 border border-gray-300 rounded-button focus:ring-2 focus:ring-primary focus:border-primary text-sm" placeholder="Enter your student ID">
                </div>
              </div>

              <div id="email-row" class="hidden">
                <label class="block text-sm font-medium text-gray-700 mb-2">Email Address</label>
                <div class="relative">
                  <i class="ri-mail-line absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                  <input id="email-input" type="email" class="w-full pl-10 pr-3 py-3 border border-gray-300 rounded-button focus:ring-2 focus:ring-primary focus:border-primary text-sm" placeholder="Enter your email address">
                </div>
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                <div class="relative">
                  <i class="ri-lock-2-line absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                  <input id="password-input" type="password" required class="w-full pl-10 pr-10 py-3 border border-gray-300 rounded-button focus:ring-2 focus:ring-primary focus:border-primary text-sm" placeholder="Enter your password">
                  <button type="button" id="toggle-pass" class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600">
                    <i class="ri-eye-line"></i>
                  </button>
                </div>
              </div>

              <div id="student-section-row" class="hidden">
                <label class="block text-sm font-medium text-gray-700 mb-2">Section</label>
                <div class="relative">
                  <i class="ri-layout-grid-line absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                  <select id="student-section" class="w-full pl-10 pr-3 py-3 border border-gray-300 rounded-button focus:ring-2 focus:ring-primary focus:border-primary text-sm">
                    <option value="" disabled selected>Select your section</option>
                    <option>BIT 3A-A</option>
                    <option>BIT 3A-B</option>
                    <option>BIT 3B-A</option>
                    <option>BIT 3B-B</option>
                  </select>
                </div>
              </div>

              <div class="flex items-center justify-between pt-1">
                <label class="flex items-center gap-2 text-sm text-gray-600 cursor-pointer">
                  <input type="checkbox" class="rounded border-gray-300 text-primary focus:ring-primary">
                  Remember me
                </label>
                <a href="#" class="text-sm text-primary hover:underline">Forgot password?</a>
              </div>

              <button id="submit-btn" type="submit" class="w-full px-4 py-3 bg-primary text-white rounded-button hover:bg-primary/90 transition shadow-sm active:scale-[.99]">
                Sign in as Student
              </button>
            </form>
          </div>

          <div class="px-5 md:px-6 pb-5 md:pb-6">
            <div class="rounded-xl border border-primary/20 bg-primary/5 p-4 text-sm">
              <div class="flex items-center justify-between flex-wrap gap-3">
                <div class="text-gray-700">
                  <div class="font-semibold">New to SLSU Lucena?</div>
                  <div class="text-gray-600">Create your account to access the class schedule management system.</div>
                </div>
                <button id="open-register" class="px-4 py-2 rounded-button border border-primary text-primary hover:bg-primary/10 transition">
                  Register Now
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>

  
  <div id="register-modal" class="fixed inset-0 bg-black/50 z-50 hidden">
    <div class="min-h-full w-full flex items-center justify-center p-4">
      <div id="register-panel" class="bg-white rounded-2xl w-full max-w-md overflow-hidden shadow-xl">
        <div class="px-6 py-5 border-b border-gray-200 flex items-center justify-between">
          <div class="flex items-center gap-3">
            <div class="w-9 h-9 rounded-full bg-primary/10 text-primary flex items-center justify-center">
              <i class="ri-user-add-line text-lg"></i>
            </div>
            <div>
              <div id="register-title" class="text-lg font-bold text-gray-800">Create an Account</div>
              <div id="register-subtitle" class="text-xs text-gray-500 -mt-0.5">Choose your role to continue</div>
            </div>
          </div>
          <button id="close-register" class="w-8 h-8 rounded-full hover:bg-gray-100 text-gray-500 flex items-center justify-center">
            <i class="ri-close-line text-xl"></i>
          </button>
        </div>

        <div id="register-role" class="px-6 py-6 space-y-4">
          <button id="choose-student" class="w-full px-4 py-3 rounded-button border border-primary text-primary hover:bg-primary/10 transition flex items-center justify-center gap-2">
            <i class="ri-graduation-cap-line"></i><span>Register as Student</span>
          </button>
          <button id="choose-teacher" class="w-full px-4 py-3 rounded-button border border-primary text-primary hover:bg-primary/10 transition flex items-center justify-center gap-2">
            <i class="ri-user-voice-line"></i><span>Register as Teacher</span>
          </button>
        </div>

        <div id="register-form-wrap" class="hidden">
          <div class="max-h-[70vh] overflow-y-auto px-6 py-6">
            <form id="register-form" class="space-y-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Full Name</label>
                <div class="relative">
                  <i class="ri-user-3-line absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                  <input id="reg-fullname" type="text" required class="w-full pl-10 pr-3 py-3 border border-gray-300 rounded-button focus:ring-2 focus:ring-primary focus:border-primary text-sm" placeholder="Enter your full name">
                </div>
              </div>

              <div id="reg-student-id-group">
                <label class="block text-sm font-medium text-gray-700 mb-2">Student ID</label>
                <div class="relative">
                  <i class="ri-id-card-line absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                  <input id="reg-student-id" type="text" class="w-full pl-10 pr-3 py-3 border border-gray-300 rounded-button focus:ring-2 focus:ring-primary focus:border-primary text-sm" placeholder="Enter your student ID">
                </div>
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Email Address</label>
                <div class="relative">
                  <i class="ri-mail-line absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                  <input id="reg-email" type="email" required class="w-full pl-10 pr-3 py-3 border border-gray-300 rounded-button focus:ring-2 focus:ring-primary focus:border-primary text-sm" placeholder="Enter your email address">
                </div>
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                <div class="relative">
                  <i class="ri-lock-2-line absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                  <input id="reg-password" type="password" required class="w-full pl-10 pr-10 py-3 border border-gray-300 rounded-button focus:ring-2 focus:ring-primary focus:border-primary text-sm" placeholder="Create a password">
                  <button type="button" id="toggle-reg-pass" class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600">
                    <i class="ri-eye-line"></i>
                  </button>
                </div>
              </div>

              <div id="reg-student-section-group">
                <label class="block text-sm font-medium text-gray-700 mb-2">Section</label>
                <div class="relative">
                  <i class="ri-layout-grid-line absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                  <select id="reg-section" class="w-full pl-10 pr-3 py-3 border border-gray-300 rounded-button focus:ring-2 focus:ring-primary focus:border-primary text-sm">
                    <option value="" disabled selected>Select your section</option>
                    <option>BIT 3A-A</option>
                    <option>BIT 3A-B</option>
                    <option>BIT 3B-A</option>
                    <option>BIT 3B-B</option>
                  </select>
                </div>
              </div>

              <button type="submit" class="w-full px-4 py-3 bg-primary text-white rounded-button hover:bg-primary/90 transition">
                Create Account
              </button>
            </form>
          </div>
        </div>

      </div>
    </div>
  </div>

  <footer class="bg-primary text-white py-12">
    <div class="px-6">
      <div class="max-w-6xl mx-auto">
        <div class="grid md:grid-cols-2 gap-8">
          <div>
            <h3 class="text-xl font-bold mb-4">SLSU Lucena Campus</h3>
            <p class="text-white/80 mb-4">Southern Luzon State University Lucena Campus</p>
            <div class="flex items-center space-x-4">
              <a href="https://www.facebook.com/profile.php?id=100064260360036" target="_blank" rel="noopener noreferrer" aria-label="SLSU Lucena Facebook Page" class="p-2 rounded-full hover:bg-white/10 transition active:scale-95">
                <i class="ri-facebook-line text-xl"></i>
              </a>
            </div>
          </div>
          <div>
            <h3 class="text-xl font-bold mb-4">Contact Information</h3>
            <div class="space-y-3 text-white/80">
              <div class="flex items-center space-x-3"><i class="ri-map-pin-line"></i><span>Ibabang Dupay, Lucena City</span></div>
              <div class="flex items-center space-x-3"><i class="ri-phone-line"></i><span>(042) 123-4567</span></div>
              <div class="flex items-center space-x-3"><i class="ri-mail-line"></i><span>info@slsu-lucena.edu.ph</span></div>
            </div>
          </div>
        </div>
        <div class="border-t border-white/20 mt-8 pt-8 text-center text-white/80">
          <p>&copy; 2025 SLSU Lucena Class Schedule Viewer. All rights reserved.</p>
        </div>
      </div>
    </div>
  </footer>

  
  <script type="module" src="assets/js/firebase-config.js"></script>
  <script>
  if (location.hostname === '127.0.0.1') {
    location.replace(location.href.replace('127.0.0.1', 'localhost'));
  }
</script>

  <script type="module">
    import {
      createUserWithEmailAndPassword, signInWithEmailAndPassword,
      updateProfile
    } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-auth.js";
    import {
      doc, getDoc, setDoc, serverTimestamp
    } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore.js";

    const { auth, db } = window.__FB;

    const toast = (msg) => {
      const box = document.getElementById('toast');
      const span = document.getElementById('toast-msg');
      span.textContent = msg;
      box.classList.remove('hidden');
      box.classList.remove('animate-fade-out');
      box.classList.add('animate-fade-in');
      setTimeout(() => {
        box.classList.remove('animate-fade-in');
        box.classList.add('animate-fade-out');
        setTimeout(()=> box.classList.add('hidden'), 250);
      }, 1600);
    };
    const capWords = (s)=> s.split(/[\s._-]+/).filter(Boolean).map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(' ');
    const setSession = (obj)=> Object.entries(obj).forEach(([k,v])=> v==null ? sessionStorage.removeItem(k) : sessionStorage.setItem(k,String(v)));
    const ensureUserDoc = async (uid, data) => {
      const ref = doc(db, 'users', uid);
      const snap = await getDoc(ref);
      await setDoc(ref, snap.exists()
        ? { ...snap.data(), ...data, updatedAt: serverTimestamp() }
        : { ...data, createdAt: serverTimestamp(), updatedAt: serverTimestamp() }
      );
    };

    const tabStudent = document.getElementById('tab-student');
    const tabTeacher = document.getElementById('tab-teacher');
    const tabAdmin   = document.getElementById('tab-admin');

    const idLabel = document.getElementById('id-label');
    const idInput = document.getElementById('id-input');
    const submitBtn = document.getElementById('submit-btn');

    const studentRow = document.getElementById('student-section-row');
    const studentNameRow = document.getElementById('student-name-row');
    const emailRow = document.getElementById('email-row');
    const loginCard = document.getElementById('login-card');
    let currentRole = 'student';

    const setActive = (tab)=>{
      [tabStudent, tabTeacher, tabAdmin].forEach(b=>{
        b.classList.remove('bg-white','text-primary','shadow-sm');
        b.classList.add('text-gray-700');
      });
      tab.classList.add('bg-white','text-primary','shadow-sm');
      tab.classList.remove('text-gray-700');
    };

    tabStudent.addEventListener('click', () => {
      setActive(tabStudent);
      currentRole = 'student';
      idLabel.textContent = 'Student ID';
      idInput.placeholder = 'Enter your student ID';
      idInput.type = 'text';
      submitBtn.textContent = 'Sign in as Student';
      studentRow.classList.remove('hidden');
      studentNameRow.classList.remove('hidden');
      emailRow.classList.remove('hidden');
    });
    tabTeacher.addEventListener('click', () => {
      setActive(tabTeacher);
      currentRole = 'teacher';
      idLabel.textContent = 'Email Address';
      idInput.placeholder = 'Enter your email address';
      idInput.type = 'email';
      submitBtn.textContent = 'Sign in as Teacher';
      studentRow.classList.add('hidden');
      studentNameRow.classList.add('hidden');
      emailRow.classList.add('hidden');
    });
    tabAdmin.addEventListener('click', () => {
      setActive(tabAdmin);
      currentRole = 'admin';
      idLabel.textContent = 'Username (email)';
      idInput.placeholder = 'Enter your admin email';
      idInput.type = 'email';
      submitBtn.textContent = 'Sign in as Admin';
      studentRow.classList.add('hidden');
      studentNameRow.classList.add('hidden');
      emailRow.classList.add('hidden');
    });
    tabStudent.click();

  
    const passInput = document.getElementById('password-input');
    const togglePass = document.getElementById('toggle-pass');
    togglePass.addEventListener('click', ()=>{
      const isPwd = passInput.type === 'password';
      passInput.type = isPwd ? 'text' : 'password';
      togglePass.innerHTML = isPwd ? '<i class="ri-eye-off-line"></i>' : '<i class="ri-eye-line"></i>';
    });

  
    document.getElementById('login-form').addEventListener('submit', async (e)=>{
      e.preventDefault();
      if (!navigator.onLine) { toast('You are offline.'); return; }

      const password = passInput.value.trim();
      const idValue  = idInput.value.trim();

      try {
        let email, displayName, section, studentId, role;

        if (currentRole === 'student') {
          displayName = document.getElementById('student-fullname').value.trim();
          email       = document.getElementById('email-input').value.trim();
          section     = document.getElementById('student-section').value;
          studentId   = idValue;
          role        = 'student';

          if (!displayName || !email || !studentId || !section || !password) {
            toast('Please complete all student fields.');
            return;
          }

          try {
            const { user } = await signInWithEmailAndPassword(auth, email, password);
            await ensureUserDoc(user.uid, { name: displayName, email, role, section, studentId });
            await updateProfile(user, { displayName });
          } catch (err) {
            if (err.code === 'auth/user-not-found') {
              const { user } = await createUserWithEmailAndPassword(auth, email, password);
              await updateProfile(user, { displayName });
              await ensureUserDoc(user.uid, { name: displayName, email, role, section, studentId });
            } else {
              throw err;
            }
          }

          setSession({
            auth_name: displayName,
            auth_role: role,
            auth_email: email,
            auth_id: studentId,
            auth_section: section
          });

        } else {
          email = idValue; 
          role  = currentRole;
          if (!email || !password) { toast('Enter your email & password.'); return; }
          displayName = capWords(email.split('@')[0].replace(/\d+/g,'') || role);

          try {
            const { user } = await signInWithEmailAndPassword(auth, email, password);
            await ensureUserDoc(user.uid, { name: displayName, email, role });
            await updateProfile(user, { displayName });
          } catch (err) {
            if (err.code === 'auth/user-not-found') {
              const { user } = await createUserWithEmailAndPassword(auth, email, password);
              await updateProfile(user, { displayName });
              await ensureUserDoc(user.uid, { name: displayName, email, role });
            } else {
              throw err;
            }
          }

          setSession({
            auth_name: displayName,
            auth_role: role,
            auth_email: email,
            auth_id: email.split('@')[0],
            auth_section: null
          });
        }

       
        window.location.href = 'index.html?welcome=1';
      } catch (err) {
        console.error(err);
        toast(err.message?.replace('Firebase: ', '') || 'Sign-in failed.');
      }
    });

 
    const regModal = document.getElementById('register-modal');
    const registerPanel = document.getElementById('register-panel');
    const openRegister = document.getElementById('open-register');
    const closeRegister = document.getElementById('close-register');
    const roleView = document.getElementById('register-role');
    const formWrap = document.getElementById('register-form-wrap');
    const regTitle = document.getElementById('register-title');
    const regSubtitle = document.getElementById('register-subtitle');
    const chooseStudent = document.getElementById('choose-student');
    const chooseTeacher = document.getElementById('choose-teacher');
    const regStudentIdGroup = document.getElementById('reg-student-id-group');
    const regStudentSectionGroup = document.getElementById('reg-student-section-group');
    const toggleRegPass = document.getElementById('toggle-reg-pass');
    const regPassword = document.getElementById('reg-password');

    openRegister.addEventListener('click', () => {
      regTitle.textContent = 'Create an Account';
      regSubtitle.textContent = 'Choose your role to continue';
      roleView.classList.remove('hidden');
      formWrap.classList.add('hidden');
      regModal.classList.remove('hidden');
    });
    const closeReg = ()=> regModal.classList.add('hidden');
    closeRegister.addEventListener('click', closeReg);
    regModal.addEventListener('click', (e)=>{ if(e.target === regModal) closeReg(); });

    chooseStudent.addEventListener('click', ()=>{
      regTitle.textContent = 'Register as Student';
      regSubtitle.textContent = 'Fill out the information below';
      roleView.classList.add('hidden');
      formWrap.classList.remove('hidden');
      regStudentIdGroup.classList.remove('hidden');
      regStudentSectionGroup.classList.remove('hidden');
    });
    chooseTeacher.addEventListener('click', ()=>{
      regTitle.textContent = 'Register as Teacher';
      regSubtitle.textContent = 'Fill out the information below';
      roleView.classList.add('hidden');
      formWrap.classList.remove('hidden');
      regStudentIdGroup.classList.add('hidden');
      regStudentSectionGroup.classList.add('hidden');
    });

    toggleRegPass.addEventListener('click', ()=>{
      const isPwd = regPassword.type === 'password';
      regPassword.type = isPwd ? 'text' : 'password';
      toggleRegPass.innerHTML = isPwd ? '<i class="ri-eye-off-line"></i>' : '<i class="ri-eye-line"></i>';
    });

    document.getElementById('register-form').addEventListener('submit', async (e)=>{
      e.preventDefault();
      if (!navigator.onLine) { toast('You are offline.'); return; }

      const full = document.getElementById('reg-fullname').value.trim();
      const email = document.getElementById('reg-email').value.trim();
      const pass  = document.getElementById('reg-password').value.trim();
      const sidEl = document.getElementById('reg-student-id');
      const secEl = document.getElementById('reg-section');

      const sid   = sidEl && sidEl.value ? sidEl.value.trim() : '';
      const sec   = secEl && secEl.value ? secEl.value.trim() : '';
      const role  = (sid && sec) ? 'student' : 'teacher';

      try {
        const { user } = await createUserWithEmailAndPassword(auth, email, pass);
        await updateProfile(user, { displayName: full || capWords(email.split('@')[0]) });
        await ensureUserDoc(user.uid, {
          name: full || capWords(email.split('@')[0]),
          email, role,
          studentId: sid || null, section: sec || null
        });

      
        toast("You're now registered 🎉");
        registerPanel.classList.add('animate-fade-out');
        setTimeout(()=>{
          regModal.classList.add('hidden');
          registerPanel.classList.remove('animate-fade-out');

          
          tabStudent.click();
          document.getElementById('email-input').value = email; 
          idInput.value = role==='student' ? (sid || '') : email;
          loginCard.classList.add('animate-pulse-card');
          setTimeout(()=> loginCard.classList.remove('animate-pulse-card'), 1600);
        }, 250);

      } catch (err) {
        console.error(err);
        toast(err.message?.replace('Firebase: ', '') || 'Registration failed.');
      }
    });
  </script>
</body>
</html>
